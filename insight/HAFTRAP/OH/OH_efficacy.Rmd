# Sham vs. HEPA - is there a difference?
This notebook investigates whether the installation of air purifiers had a notable impact on indoor air quality across various summary metrics. It uses summary data found in `summary/HAFTRAP/OH`

```{r}
library(ggplot2)
library(tidyverse)
```

Set working directory
```{r, setup, include=FALSE}
knitr::opts_knit$set(root.dir = 'C:/Users/vkuchhal/Documents/hepa-summer23')
```

```{r}
# Get file path
if (!endsWith(getwd(), "hepa-summer23")) {
  stop("Incorrect working directory")
}
```

```{r}
path_to_data <- "summary/HAFTRAP/OH/"
```

## Load Data
### CPC
```{r}
filepath <- paste0(path_to_data, "s_OH_C_quants.csv")
cpc_stats <- read_csv(filepath, show_col_types = FALSE)
```

### Mod-PM
```{r}
filepath <- paste0(path_to_data, "s_OH_M_quants.csv")
modpm_stats <- read_csv(filepath, show_col_types = FALSE)
```

## Calculate Average Percentage Reductions
### Helper function:
Since the process of summarizing data is almost exactly the same across Mod-PM/CPC and indoor/ratio, the following function reduces a lot of repeat code
```{r}
get_sums <- function(df_stats, env, p_types) {
  df_stats %>%
  # Filter the % reduction values for specified environment, particle types
  filter(case == "redu", environment == env, type %in% p_types) %>%
  
  # Find median of summary statistics
  group_by(type) %>%
  summarise(across(mean:sd, median))
}

```

### Reduction in raw Indoor Concentrations
```{r}
# Calculate CPC, Mod-PM averages for indoor
cpc_sum <- get_sums(cpc_stats, "indoor", c("concent"))
modpm_sum <- get_sums(modpm_stats, "indoor", 
                      c("pm1", "pm25", "pm10", "pm1num"))

joined_indoor <- rbind(modpm_sum, cpc_sum)
```

### Reduction in Indoor/Outdoor Ratio
```{r}
# Calculate CPC, Mod-PM averages for I/O ratio
cpc_sum <- get_sums(cpc_stats, "ratio", c("concent"))
modpm_sum <- get_sums(modpm_stats, "ratio", 
                      c("pm1", "pm25", "pm10", "pm1num"))

joined_ratio <- rbind(modpm_sum, cpc_sum)
```

## Save to file
Save the two tables with efficacy in CSV files
```{r}
# Save summary statistic files to CSVs
write.csv(joined_indoor, "artifacts/indoor_reduction.csv")
write.csv(joined_ratio, "artifacts/ratio_reduction.csv")
```